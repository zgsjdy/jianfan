"use strict";const t=require("../../common/vendor.js"),e=require("../../utils/getSysInf.js"),a=require("../../utils/myRef.js"),o=require("../hooks/usecomSearchBox.js"),s=require("../../stores/counter.js");if(!Array){(t.resolveComponent("uni-icons")+t.resolveComponent("uni-load-more"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js"))();const n=t.defineComponent({__name:"comSearchBox",setup(n){const r=s.useBotNarStor().QJScreenOnceimg.searchBoxStatus.NoResults;function u(){t.index.navigateBack()}let i,c=a.myRef("",300);i=t.reactive(new class extends class{constructor(t,e){this.whetherOrNotToFocus=t??!1,this.searchName=e||"",this.searchTispData,this.newset=new Set,this.searTispStyle={opacity:0,transform:"translateY(-12px) scale(1,0)"}}}{constructor(t,e,a="不需要值（如果加了问号就不能有默认值）"){super(t,e),this.houby=a}getWhetherOrNotToFocus(t=!1,e){return this.whetherOrNotToFocus=!0,!0===this.whetherOrNotToFocus?(t&&(this.searTispStyle=Object.assign(this.searTispStyle,{opacity:1,transform:"translateY(0px) scale(1,1)"})),"聚焦"):e}getWhetherOrNotToBlur(t=!1,e){return this.whetherOrNotToFocus=!1,!1===this.whetherOrNotToFocus?(t&&(this.searTispStyle=Object.assign(this.searTispStyle,{opacity:0,transform:"translateY(-12px) scale(1,0)"})),"失焦"):e}}(!1,c.value));let l=new Map,h=0,f=/^[\u4e00-\u9fa5a-zA-Z\s]*[\u4e00-\u9fa5a-zA-Z][\u4e00-\u9fa5a-zA-Z\s]*$/;function p(t,e,a="red"){const o=new RegExp(e,"gi");return t.replace(o,`<span style='color: ${a}'>${e}</span>`)}t.watch([c,()=>i.whetherOrNotToFocus],(([t,a],[o,s])=>{i.whetherOrNotToFocus?null!==c.value&&void 0!==c.value&&f.test(c.value)&&(!function(t,e,a){const o=t.size;if(a>=o)return!1;if(o>=e){const e=Array.from(t.keys());for(let o=0;o<a;o++)t.delete(e[o]);return!0}}(l,600,100),console.log(l),l.has(c.value)?(i.searchTispData=l.get(c.value),i.getWhetherOrNotToFocus(!0)):e.queryInput("jianfandata","jfContentsData",{name:c.value},5,"降序").then((t=>{0!==t.data.length?(i.searchTispData=t.data.map((t=>{const e=`<div style="\n\t\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\t\tfont-size: 2.3vh;\n\t\t\t\t\t\t\t\tline-height: 5vh;">${p(t.name,c.value,"#ff7878")}</div>`;return{...t,mark:e}})),t.data.map((t=>{i.newset.add(JSON.stringify(t))})),i.newset.size>=h&&(l.set(c.value,i.searchTispData),h=i.newset.size),i.whetherOrNotToFocus&&i.getWhetherOrNotToFocus(!0)):i.searchTispData=[]}))):i.getWhetherOrNotToBlur(!0)}));let{contentListData:m,contentStatus:v,reviseStatus:d}=o.usecomSearchBox();let T=function(){let t=0,a=0;return async function o(s){let n,r=s||c.value;if(r!==s)return t++,void(1===t&&setTimeout((async()=>{await o(c.value),t=0}),300));d("no-more"),l.has(r)?(m.value=l.get(r),d("value")):null!=r&&f.test(r)&&(d("loading"),n=await e.queryInput("jianfandata","jfContentsData",{name:r},8,"降序"),0!==n.data.length?(m.value=n.data.map((t=>{const e=`<div style="\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tfont-size: 2.3vh;\n\t\t\t\t\t\t\tline-height: 5vh;">${p(t.name,r,"#ff7878")}</div>`;return{...t,mark:e}})),l.set(r,m.value),d("value")):(d("no-more"),m.value=[])),r===s&&null!=r&&""!==r?(a++,1===a&&setTimeout((()=>{c.value="",a=0}),300)):c.value=""}}();function g(t){T(t.detail.value)}return(e,a)=>t.e({a:t.o((e=>t.unref(i).getWhetherOrNotToFocus(!1,e))),b:t.o((e=>t.unref(i).getWhetherOrNotToBlur(!1,e))),c:t.o(g),d:t.unref(c),e:t.o((e=>t.isRef(c)?c.value=e.detail.value:c=e.detail.value)),f:t.o(t.unref(T)),g:t.p({type:"search",size:"3vh",color:"#924BDA"}),h:t.o(u),i:t.p({type:"undo",size:"4.5vh",color:"#fff"}),j:t.f(t.unref(i).searchTispData,((e,a,o)=>({a:e.mark,b:t.o((a=>t.unref(T)(e.name)),a),c:a}))),k:t.s(t.unref(i).searTispStyle),l:"no-more"===t.unref(v)},"no-more"===t.unref(v)?{m:t.unref(r)}:"loading"===t.unref(v)?{o:t.p({iconType:"circle",status:t.unref(v)})}:{p:t.f(t.unref(m),((e,a,o)=>({a:e.topurl,b:t.t(e.name),c:a})))},{n:"loading"===t.unref(v)})}}),r=t._export_sfc(n,[["__scopeId","data-v-1c2e607d"]]);wx.createComponent(r);
