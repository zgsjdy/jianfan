"use strict";const e=require("../../../common/vendor.js"),t=require("../../../utils/getSysInf.js"),r=require("../../../utils/myRef.js"),a=require("../hooks/usecomSearchBox.js"),n=require("../../../stores/counter.js");if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-load-more"))()}Math||((()=>"../../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js"))();const s=e.defineComponent({__name:"comSearchBox",setup(s){const o=n.useBotNarStor(),i=o.QJScreenOnceimg.searchBoxStatus.NoResults,h=o.QJScreenOnceimg.searchBoxStatus.waterRipples,{menheight:u,statusBarHeight:l}=t.getTobBotMar("top"),{botSafeHeight:c}=t.getTobBotMar("bot");function f(){e.index.navigateBack()}let d,p=r.myRef("",300);d=e.reactive(new class extends class{constructor(e,t){this.whetherOrNotToFocus=e??!1,this.searchName=t||"",this.searchTispData,this.newset=new Set,this.searTispStyle={opacity:0,transform:"translateY(-12px) scale(1,0)",height:"40vh"}}}{constructor(e,t,r="no-more"){super(e,t),this.PopPromptsLoading=r}setHeight(e,t){let r=e*t+9;this.searTispStyle.height=0===t||0===e?"9vh":r>=40?"40vh":r.toFixed(1)+"vh"}getWhetherOrNotToFocus(e=!1,t){return this.whetherOrNotToFocus=!0,!0===this.whetherOrNotToFocus?(e&&(this.searTispStyle=Object.assign(this.searTispStyle,{opacity:1,transform:"translateY(0px) scale(1,1)"})),"聚焦"):t}getWhetherOrNotToBlur(e=!1,t){return this.whetherOrNotToFocus=!1,!1===this.whetherOrNotToFocus?(e&&(this.searTispStyle=Object.assign(this.searTispStyle,{opacity:0,transform:"translateY(-12px) scale(1,0)"})),"失焦"):t}}(!1,p.value));let m=new Map,g=0,v=/^[\u4e00-\u9fa5a-zA-Z\s]*[\u4e00-\u9fa5a-zA-Z][\u4e00-\u9fa5a-zA-Z\s]*$/;function S(e,t,r="red"){const a=new RegExp(t,"gi");return e.replace(a,`<span style='color: ${r}'>${t}</span>`)}e.watch([p,()=>d.whetherOrNotToFocus],(([e,r],[a,n])=>{d.whetherOrNotToFocus?null!==p.value&&void 0!==p.value&&v.test(p.value)&&(!function(e,t,r){const a=e.size;if(r>=a)return!1;if(a>=t){const t=Array.from(e.keys());for(let a=0;a<r;a++)e.delete(t[a]);return!0}}(m,600,100),m.has(p.value)?(d.searchTispData=m.get(p.value),d.getWhetherOrNotToFocus(!0),d.setHeight(6.3,d.searchTispData.length),d.PopPromptsLoading="more"):(d.PopPromptsLoading="loading",t.queryInput("jianfandata","jfContentsData",{name:p.value},8,"降序").then((e=>{0!==e.data.length?(d.searchTispData=e.data.map((e=>{const t=`<div style="\n\t\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\t\tfont-size: 2.3vh;\n\t\t\t\t\t\t\t\tline-height: 5vh;">${S(e.name,p.value,"#ff7878")}</div>`;return{...e,mark:t}})),e.data.map((e=>{d.newset.add(JSON.stringify(e))})),d.newset.size>=g&&""!==p.value&&(m.set(p.value,d.searchTispData),g=d.newset.size),d.whetherOrNotToFocus&&d.getWhetherOrNotToFocus(!0),d.setHeight(6.3,d.searchTispData.length),d.PopPromptsLoading="more"):(d.searchTispData=[],d.setHeight(6.3,d.searchTispData.length),d.PopPromptsLoading="no-more")})))):d.getWhetherOrNotToBlur(!0)}));let{contentListData:y,contentStatus:T,reviseStatus:w,bottomLoad:D}=a.usecomSearchBox();let x=function(){let e=0,r=0;return async function a(n){let s,o=n||p.value;if("setSatus"in D&&D.setSatus("more"),o!==n)return e++,void(1===e&&setTimeout((async()=>{await a(p.value),e=0}),300));w("no-more"),m.has(o)?(y.value=m.get(o),"addhSarr"in N&&N.addhSarr(o),"recordValue"in D&&(D.recordValue=o),w("value")):null!=o&&v.test(o)&&(w("loading"),s=await t.queryInput("jianfandata","jfContentsData",{name:o},8,"降序"),0!==s.data.length?(y.value=s.data.map((e=>{const t=`<div style="\n\t\t\t\t\t\t\twidth: 100%;\n\t\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\t\tfont-size: 2.3vh;\n\t\t\t\t\t\t\tline-height: 5vh;">${S(e.name,o,"#ff7878")}</div>`;return{...e,mark:t}})),m.set(o,y.value),"addhSarr"in N&&N.addhSarr(o),"recordValue"in D&&(D.recordValue=o),w("value")):(w("no-more"),y.value=[])),o===n&&null!=o&&""!==o?(r++,1===r&&setTimeout((()=>{p.value="",r=0}),300)):p.value=""}}();function O(e){x(e.detail.value)}let N=e.reactive(new class{constructor(e=[],t=!1){this.hSarr=e,this.whetherDelete=t}addhSarr(e){let t=this.hSarr.indexOf(e);if(this.hSarr.length>=25&&this.hSarr.pop(),-1!==t){let r;r=this.hSarr.splice(t,1)[0],""!==r&&null!=r&&this.hSarr.unshift(e)}else""!==e&&null!=e&&this.hSarr.unshift(e)}setwhetherDelete(e){this.whetherDelete=e}deleteAnyClick(e,t){this.whetherDelete?(this.hSarr.splice(t,1),0===this.hSarr.length&&(this.whetherDelete=!1)):p.value=e}});return e.onBeforeUnmount((()=>{e.index.setStorage({key:"Searchforhistoricaldata",data:N.hSarr,success(){}})})),e.onMounted((()=>{e.index.getStorage({key:"Searchforhistoricaldata",success(e){0!==e.data.length&&(N.hSarr=e.data)}})})),(r,a)=>e.e({a:e.o((t=>e.unref(d).getWhetherOrNotToFocus(!1,t))),b:e.o((t=>e.unref(d).getWhetherOrNotToBlur(!1,t))),c:e.o(O),d:e.unref(p),e:e.o((t=>e.isRef(p)?p.value=t.detail.value:p=t.detail.value)),f:e.o(e.unref(x)),g:e.p({type:"search",size:"3vh",color:"#924BDA"}),h:e.o(f),i:e.p({type:"undo",size:"4.5vh",color:"#fff"}),j:e.f(e.unref(d).searchTispData,((t,r,a)=>e.e({a:r<5},r<5?{b:t.mark,c:e.o((r=>e.unref(x)(t.name)),r),d:e.f(6,((e,t,r)=>({a:t}))),e:e.s(`background-image: url(${t.topurl});`)}:{},{f:r}))),k:e.p({iconType:"circle",contentText:{contentdown:"o((>ω< ))o",contentrefresh:"正在加载...",contentnomore:"没有更多数据了"},status:e.unref(d).PopPromptsLoading}),l:e.unref(h),m:e.s(e.unref(d).searTispStyle),n:0!==e.unref(N).hSarr.length},0!==e.unref(N).hSarr.length?e.e({o:e.f(e.unref(N).hSarr,((t,r,a)=>({a:e.t(t),b:r,c:e.o((a=>e.unref(N).deleteAnyClick(t,r)),r)}))),p:e.n(e.unref(N).whetherDelete?"historySearchListAfter":""),q:!e.unref(N).whetherDelete},e.unref(N).whetherDelete?{t:e.o((t=>e.unref(N).setwhetherDelete(!1))),v:e.p({type:"closeempty",size:"2vh"})}:{r:e.o((t=>e.unref(N).setwhetherDelete(!0))),s:e.p({type:"trash",size:"2vh"})}):{},{w:"no-more"===e.unref(T)},"no-more"===e.unref(T)?{x:e.unref(i)}:"loading"===e.unref(T)?{z:e.p({iconType:"circle",status:e.unref(T)})}:{A:e.f(e.unref(y),((t,r,a)=>({a:t.topurl,b:e.t(t.name),c:r,d:`/pagesResource/displaysTheAnalyzedContent/displaysTheAnalyzedContent?nameId=${t.name}`})))},{y:"loading"===e.unref(T),B:e.s(`visibility: ${"more"===e.unref(D).bottStatus.value?"hidden":"visible"};`),C:e.p({iconType:"circle",status:e.unref(D).bottStatus.value,contentText:{contentdown:" "}}),D:e.s(`height: calc(100vh - ${e.unref(c)+e.unref(u)+e.unref(l)+3}px);`),E:e.o((r=>e.unref(D).load(e.unref(t.queryInput),e.unref(y).length)))})}}),o=e._export_sfc(s,[["__scopeId","data-v-dcaa746f"]]);wx.createComponent(o);
